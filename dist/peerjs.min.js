var Sr=Object.create;var ae=Object.defineProperty,_r=Object.defineProperties,br=Object.getOwnPropertyDescriptor,Tr=Object.getOwnPropertyDescriptors,Rr=Object.getOwnPropertyNames,ut=Object.getOwnPropertySymbols,kr=Object.getPrototypeOf,ht=Object.prototype.hasOwnProperty,Pr=Object.prototype.propertyIsEnumerable;var mt=(e,t,r)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Z=(e,t)=>{for(var r in t||(t={}))ht.call(t,r)&&mt(e,r,t[r]);if(ut)for(var r of ut(t))Pr.call(t,r)&&mt(e,r,t[r]);return e},Se=(e,t)=>_r(e,Tr(t)),gt=e=>ae(e,"__esModule",{value:!0});var ce=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),pe=(e,t)=>{gt(e);for(var r in t)ae(e,r,{get:t[r],enumerable:!0})},xr=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Rr(t))!ht.call(e,n)&&n!=="default"&&ae(e,n,{get:()=>t[n],enumerable:!(r=br(t,n))||r.enumerable});return e},H=e=>xr(gt(ae(e!=null?Sr(kr(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var Q=(e,t,r)=>new Promise((n,i)=>{var a=s=>{try{f(r.next(s))}catch(o){i(o)}},p=s=>{try{f(r.throw(s))}catch(o){i(o)}},f=s=>s.done?n(s.value):Promise.resolve(s.value).then(a,p);f((r=r.apply(e,t)).next())});var je=ce((Nr,fe)=>{var w={};w.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}();w.useArrayBufferView=!w.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch(e){return!0}}();fe.exports.binaryFeatures=w;var vt=fe.exports.BlobBuilder;typeof window!="undefined"&&(vt=fe.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function _e(){this._pieces=[],this._parts=[]}_e.prototype.append=function(e){typeof e=="number"?this._pieces.push(e):(this.flush(),this._parts.push(e))};_e.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);w.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}};_e.prototype.getBuffer=function(){if(this.flush(),w.useBlobBuilder){for(var e=new vt,t=0,r=this._parts.length;t<r;t++)e.append(this._parts[t]);return e.getBlob()}else return new Blob(this._parts)};fe.exports.BufferBuilder=_e});var St=ce((zr,Ct)=>{var Er=je().BufferBuilder,yt=je().binaryFeatures,Dr={unpack:function(e){var t=new E(e);return t.unpack()},pack:function(e){var t=new D;t.pack(e);var r=t.getBuffer();return r}};Ct.exports=Dr;function E(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}E.prototype.unpack=function(){var e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;var t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}};E.prototype.unpack_uint8=function(){var e=this.dataView[this.index]&255;return this.index++,e};E.prototype.unpack_uint16=function(){var e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t};E.prototype.unpack_uint32=function(){var e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t};E.prototype.unpack_uint64=function(){var e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t};E.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-(1<<8)};E.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-(1<<16)};E.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)};E.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)};E.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t};E.prototype.unpack_string=function(e){for(var t=this.read(e),r=0,n="",i,a;r<e;)i=t[r],i<128?(n+=String.fromCharCode(i),r++):(i^192)<32?(a=(i^192)<<6|t[r+1]&63,n+=String.fromCharCode(a),r+=2):(a=(i&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,n+=String.fromCharCode(a),r+=3);return this.index+=e,n};E.prototype.unpack_array=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=this.unpack();return t};E.prototype.unpack_map=function(e){for(var t={},r=0;r<e;r++){var n=this.unpack(),i=this.unpack();t[n]=i}return t};E.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,n=e&8388607|8388608;return(t===0?1:-1)*n*Math.pow(2,r-23)};E.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,n=(e>>20&2047)-1023,i=e&1048575|1048576,a=i*Math.pow(2,n-20)+t*Math.pow(2,n-52);return(r===0?1:-1)*a};E.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")};function D(){this.bufferBuilder=new Er}D.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};D.prototype.pack=function(e){var t=typeof e;if(t==="string")this.pack_string(e);else if(t==="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(t==="boolean")e===!0?this.bufferBuilder.append(195):e===!1&&this.bufferBuilder.append(194);else if(t==="undefined")this.bufferBuilder.append(192);else if(t==="object")if(e===null)this.bufferBuilder.append(192);else{var r=e.constructor;if(r==Array)this.pack_array(e);else if(r==Blob||r==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(r==ArrayBuffer)yt.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)yt.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(r==Object||r.toString().startsWith("class"))this.pack_object(e);else if(r==Date)this.pack_string(e.toString());else if(typeof e.toBinaryPack=="function")this.bufferBuilder.append(e.toBinaryPack());else throw new Error('Type "'+r.toString()+'" not yet supported')}else throw new Error('Type "'+t+'" not yet supported');this.bufferBuilder.flush()};D.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(e)};D.prototype.pack_string=function(e){var t=Ir(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(e)};D.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");for(var r=0;r<t;r++)this.pack(e[r])};D.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(e&255);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")};D.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var r=Math.floor(Math.log(e)/Math.LN2),n=e/Math.pow(2,r)-1,i=Math.floor(n*Math.pow(2,52)),a=Math.pow(2,32),p=t<<31|r+1023<<20|i/a&1048575,f=i%a;this.bufferBuilder.append(203),this.pack_int32(p),this.pack_int32(f)};D.prototype.pack_object=function(e){var t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this.bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");for(var n in e)e.hasOwnProperty(n)&&(this.pack(n),this.pack(e[n]))};D.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)};D.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(e&255)};D.prototype.pack_uint32=function(e){var t=e&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};D.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),r=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((r&4278190080)>>>24),this.bufferBuilder.append((r&16711680)>>>16),this.bufferBuilder.append((r&65280)>>>8),this.bufferBuilder.append(r&255)};D.prototype.pack_int8=function(e){this.bufferBuilder.append(e&255)};D.prototype.pack_int16=function(e){this.bufferBuilder.append((e&65280)>>8),this.bufferBuilder.append(e&255)};D.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};D.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),r=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((r&4278190080)>>>24),this.bufferBuilder.append((r&16711680)>>>16),this.bufferBuilder.append((r&65280)>>>8),this.bufferBuilder.append(r&255)};function Mr(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function Ir(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,Mr).length}});var Je=ce((Xr,Ve)=>{"use strict";var u={};u.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};u.localCName=u.generateIdentifier();u.splitLines=function(e){return e.trim().split(`
`).map(function(t){return t.trim()})};u.splitSections=function(e){var t=e.split(`
m=`);return t.map(function(r,n){return(n>0?"m="+r:r).trim()+`\r
`})};u.getDescription=function(e){var t=u.splitSections(e);return t&&t[0]};u.getMediaSections=function(e){var t=u.splitSections(e);return t.shift(),t};u.matchPrefix=function(e,t){return u.splitLines(e).filter(function(r){return r.indexOf(t)===0})};u.parseCandidate=function(e){var t;e.indexOf("a=candidate:")===0?t=e.substring(12).split(" "):t=e.substring(10).split(" ");for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1];break}return r};u.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),r!=="host"&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")};u.parseIceOptions=function(e){return e.substr(14).split(" ")};u.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=t.length===3?parseInt(t[2],10):1,r.numChannels=r.channels,r};u.writeRtpMap=function(e){var t=e.payloadType;e.preferredPayloadType!==void 0&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(r!==1?"/"+r:"")+`\r
`};u.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};u.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`};u.parseFmtp=function(e){for(var t={},r,n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r=n[i].trim().split("="),t[r[0].trim()]=r[1];return t};u.writeFmtp=function(e){var t="",r=e.payloadType;if(e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(i){e.parameters[i]?n.push(i+"="+e.parameters[i]):n.push(i)}),t+="a=fmtp:"+r+" "+n.join(";")+`\r
`}return t};u.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};u.writeRtcpFb=function(e){var t="",r=e.payloadType;return e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(n){t+="a=rtcp-fb:"+r+" "+n.type+(n.parameter&&n.parameter.length?" "+n.parameter:"")+`\r
`}),t};u.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r};u.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(r){return parseInt(r,10)})}};u.getMid=function(e){var t=u.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)};u.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};u.getDtlsParameters=function(e,t){var r=u.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(u.parseFingerprint)}};u.writeDtlsParameters=function(e,t){var r="a=setup:"+t+`\r
`;return e.fingerprints.forEach(function(n){r+="a=fingerprint:"+n.algorithm+" "+n.value+`\r
`}),r};u.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}};u.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?u.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`};u.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}};u.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")};u.getCryptoParameters=function(e,t){var r=u.matchPrefix(e+t,"a=crypto:");return r.map(u.parseCryptoLine)};u.getIceParameters=function(e,t){var r=u.matchPrefix(e+t,"a=ice-ufrag:")[0],n=u.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null};u.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`};u.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=u.splitLines(e),n=r[0].split(" "),i=3;i<n.length;i++){var a=n[i],p=u.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(p){var f=u.parseRtpMap(p),s=u.matchPrefix(e,"a=fmtp:"+a+" ");switch(f.parameters=s.length?u.parseFmtp(s[0]):{},f.rtcpFeedback=u.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(u.parseRtcpFb),t.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(f.name.toUpperCase());break;default:break}}}return u.matchPrefix(e,"a=extmap:").forEach(function(o){t.headerExtensions.push(u.parseExtmap(o))}),t};u.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(i){return i.preferredPayloadType!==void 0?i.preferredPayloadType:i.payloadType}).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,t.codecs.forEach(function(i){r+=u.writeRtpMap(i),r+=u.writeFmtp(i),r+=u.writeRtcpFb(i)});var n=0;return t.codecs.forEach(function(i){i.maxptime>n&&(n=i.maxptime)}),n>0&&(r+="a=maxptime:"+n+`\r
`),r+=`a=rtcp-mux\r
`,t.headerExtensions&&t.headerExtensions.forEach(function(i){r+=u.writeExtmap(i)}),r};u.parseRtpEncodingParameters=function(e){var t=[],r=u.parseRtpParameters(e),n=r.fecMechanisms.indexOf("RED")!==-1,i=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=u.matchPrefix(e,"a=ssrc:").map(function(c){return u.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"}),p=a.length>0&&a[0].ssrc,f,s=u.matchPrefix(e,"a=ssrc-group:FID").map(function(c){var d=c.substr(17).split(" ");return d.map(function(l){return parseInt(l,10)})});s.length>0&&s[0].length>1&&s[0][0]===p&&(f=s[0][1]),r.codecs.forEach(function(c){if(c.name.toUpperCase()==="RTX"&&c.parameters.apt){var d={ssrc:p,codecPayloadType:parseInt(c.parameters.apt,10)};p&&f&&(d.rtx={ssrc:f}),t.push(d),n&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:p,mechanism:i?"red+ulpfec":"red"},t.push(d))}}),t.length===0&&p&&t.push({ssrc:p});var o=u.matchPrefix(e,"b=");return o.length&&(o[0].indexOf("b=TIAS:")===0?o=parseInt(o[0].substr(7),10):o[0].indexOf("b=AS:")===0?o=parseInt(o[0].substr(5),10)*1e3*.95-50*40*8:o=void 0,t.forEach(function(c){c.maxBitrate=o})),t};u.parseRtcpParameters=function(e){var t={},r=u.matchPrefix(e,"a=ssrc:").map(function(a){return u.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=u.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=n.length===0;var i=u.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t};u.parseMsid=function(e){var t,r=u.matchPrefix(e,"a=msid:");if(r.length===1)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var n=u.matchPrefix(e,"a=ssrc:").map(function(i){return u.parseSsrcMedia(i)}).filter(function(i){return i.attribute==="msid"});if(n.length>0)return t=n[0].value.split(" "),{stream:t[0],track:t[1]}};u.parseSctpDescription=function(e){var t=u.parseMLine(e),r=u.matchPrefix(e,"a=max-message-size:"),n;r.length>0&&(n=parseInt(r[0].substr(19),10)),isNaN(n)&&(n=65536);var i=u.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:t.fmt,maxMessageSize:n};var a=u.matchPrefix(e,"a=sctpmap:");if(a.length>0){var p=u.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:n}}};u.writeSctpDescription=function(e,t){var r=[];return e.protocol!=="DTLS/SCTP"?r=["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+t.port+`\r
`]:r=["m="+e.kind+" 9 "+e.protocol+" "+t.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+t.port+" "+t.protocol+` 65535\r
`],t.maxMessageSize!==void 0&&r.push("a=max-message-size:"+t.maxMessageSize+`\r
`),r.join("")};u.generateSessionId=function(){return Math.random().toString().substr(2,21)};u.writeSessionBoilerplate=function(e,t,r){var n,i=t!==void 0?t:2;e?n=e:n=u.generateSessionId();var a=r||"thisisadapterortc";return`v=0\r
o=`+a+" "+n+" "+i+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`};u.writeMediaSection=function(e,t,r,n){var i=u.writeRtpDescription(e.kind,t);if(i+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),i+="a=mid:"+e.mid+`\r
`,e.direction?i+="a="+e.direction+`\r
`:e.rtpSender&&e.rtpReceiver?i+=`a=sendrecv\r
`:e.rtpSender?i+=`a=sendonly\r
`:e.rtpReceiver?i+=`a=recvonly\r
`:i+=`a=inactive\r
`,e.rtpSender){var a="msid:"+n.id+" "+e.rtpSender.track.id+`\r
`;i+="a="+a,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+`\r
`),i};u.getDirection=function(e,t){for(var r=u.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2);default:}return t?u.getDirection(t):"sendrecv"};u.getKind=function(e){var t=u.splitLines(e),r=t[0].split(" ");return r[0].substr(2)};u.isRejected=function(e){return e.split(" ",2)[1]==="0"};u.parseMLine=function(e){var t=u.splitLines(e),r=t[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}};u.parseOLine=function(e){var t=u.matchPrefix(e,"o=")[0],r=t.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}};u.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;for(var t=u.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||t[r].charAt(1)!=="=")return!1;return!0};typeof Ve=="object"&&(Ve.exports=u)});var zt=ce((Zr,Nt)=>{"use strict";var y=Je();function Or(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function Ut(e,t,r,n,i){var a=y.writeRtpDescription(e.kind,t);if(a+=y.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=y.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":i||"active"),a+="a=mid:"+e.mid+`\r
`,e.rtpSender&&e.rtpReceiver?a+=`a=sendrecv\r
`:e.rtpSender?a+=`a=sendonly\r
`:e.rtpReceiver?a+=`a=recvonly\r
`:a+=`a=inactive\r
`,e.rtpSender){var p=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=p;var f="msid:"+(n?n.id:"-")+" "+p+`\r
`;a+="a="+f,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+f,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+f,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+y.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+y.localCName+`\r
`),a}function Ar(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(n){if(n&&(n.urls||n.url)){var i=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var a=typeof i=="string";return a&&(i=[i]),i=i.filter(function(p){var f=p.indexOf("turn:")===0&&p.indexOf("transport=udp")!==-1&&p.indexOf("turn:[")===-1&&!r;return f?(r=!0,!0):p.indexOf("stun:")===0&&t>=14393&&p.indexOf("?transport=udp")===-1}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}function Te(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(a,p){a=parseInt(a,10);for(var f=0;f<p.length;f++)if(p[f].payloadType===a||p[f].preferredPayloadType===a)return p[f]},i=function(a,p,f,s){var o=n(a.parameters.apt,f),c=n(p.parameters.apt,s);return o&&c&&o.name.toLowerCase()===c.name.toLowerCase()};return e.codecs.forEach(function(a){for(var p=0;p<t.codecs.length;p++){var f=t.codecs[p];if(a.name.toLowerCase()===f.name.toLowerCase()&&a.clockRate===f.clockRate){if(a.name.toLowerCase()==="rtx"&&a.parameters&&f.parameters.apt&&!i(a,f,e.codecs,t.codecs))continue;f=JSON.parse(JSON.stringify(f)),f.numChannels=Math.min(a.numChannels,f.numChannels),r.codecs.push(f),f.rtcpFeedback=f.rtcpFeedback.filter(function(s){for(var o=0;o<a.rtcpFeedback.length;o++)if(a.rtcpFeedback[o].type===s.type&&a.rtcpFeedback[o].parameter===s.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(a){for(var p=0;p<t.headerExtensions.length;p++){var f=t.headerExtensions[p];if(a.uri===f.uri){r.headerExtensions.push(f);break}}}),r}function Gt(e,t,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)!==-1}function We(e,t){var r=e.getRemoteCandidates().find(function(n){return t.foundation===n.foundation&&t.ip===n.ip&&t.port===n.port&&t.priority===n.priority&&t.protocol===n.protocol&&t.type===n.type});return r||e.addRemoteCandidate(t),!r}function I(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}Nt.exports=function(e,t){function r(s,o){o.addTrack(s),o.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:s}))}function n(s,o){o.removeTrack(s),o.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:s}))}function i(s,o,c,d){var l=new Event("track");l.track=o,l.receiver=c,l.transceiver={receiver:c},l.streams=d,e.setTimeout(function(){s._dispatchEvent("track",l)})}var a=function(s){var o=this,c=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(l){o[l]=c[l].bind(c)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",s=JSON.parse(JSON.stringify(s||{})),this.usingBundle=s.bundlePolicy==="max-bundle",s.rtcpMuxPolicy==="negotiate")throw I("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(s.rtcpMuxPolicy||(s.rtcpMuxPolicy="require"),s.iceTransportPolicy){case"all":case"relay":break;default:s.iceTransportPolicy="all";break}switch(s.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:s.bundlePolicy="balanced";break}if(s.iceServers=Ar(s.iceServers||[],t),this._iceGatherers=[],s.iceCandidatePoolSize)for(var d=s.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:s.iceServers,gatherPolicy:s.iceTransportPolicy}));else s.iceCandidatePoolSize=0;this._config=s,this.transceivers=[],this._sdpSessionId=y.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(a.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(a.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),a.prototype.onicecandidate=null,a.prototype.onaddstream=null,a.prototype.ontrack=null,a.prototype.onremovestream=null,a.prototype.onsignalingstatechange=null,a.prototype.oniceconnectionstatechange=null,a.prototype.onconnectionstatechange=null,a.prototype.onicegatheringstatechange=null,a.prototype.onnegotiationneeded=null,a.prototype.ondatachannel=null,a.prototype._dispatchEvent=function(s,o){this._isClosed||(this.dispatchEvent(o),typeof this["on"+s]=="function"&&this["on"+s](o))},a.prototype._emitGatheringStateChange=function(){var s=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",s)},a.prototype.getConfiguration=function(){return this._config},a.prototype.getLocalStreams=function(){return this.localStreams},a.prototype.getRemoteStreams=function(){return this.remoteStreams},a.prototype._createTransceiver=function(s,o){var c=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:s,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&c)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var l=this._createIceAndDtlsTransports();d.iceTransport=l.iceTransport,d.dtlsTransport=l.dtlsTransport}return o||this.transceivers.push(d),d},a.prototype.addTrack=function(s,o){if(this._isClosed)throw I("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var c=this.transceivers.find(function(m){return m.track===s});if(c)throw I("InvalidAccessError","Track already exists.");for(var d,l=0;l<this.transceivers.length;l++)!this.transceivers[l].track&&this.transceivers[l].kind===s.kind&&(d=this.transceivers[l]);return d||(d=this._createTransceiver(s.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(o)===-1&&this.localStreams.push(o),d.track=s,d.stream=o,d.rtpSender=new e.RTCRtpSender(s,d.dtlsTransport),d.rtpSender},a.prototype.addStream=function(s){var o=this;if(t>=15025)s.getTracks().forEach(function(d){o.addTrack(d,s)});else{var c=s.clone();s.getTracks().forEach(function(d,l){var m=c.getTracks()[l];d.addEventListener("enabled",function(h){m.enabled=h.enabled})}),c.getTracks().forEach(function(d){o.addTrack(d,c)})}},a.prototype.removeTrack=function(s){if(this._isClosed)throw I("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(s instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var o=this.transceivers.find(function(l){return l.rtpSender===s});if(!o)throw I("InvalidAccessError","Sender was not created by this connection.");var c=o.stream;o.rtpSender.stop(),o.rtpSender=null,o.track=null,o.stream=null;var d=this.transceivers.map(function(l){return l.stream});d.indexOf(c)===-1&&this.localStreams.indexOf(c)>-1&&this.localStreams.splice(this.localStreams.indexOf(c),1),this._maybeFireNegotiationNeeded()},a.prototype.removeStream=function(s){var o=this;s.getTracks().forEach(function(c){var d=o.getSenders().find(function(l){return l.track===c});d&&o.removeTrack(d)})},a.prototype.getSenders=function(){return this.transceivers.filter(function(s){return!!s.rtpSender}).map(function(s){return s.rtpSender})},a.prototype.getReceivers=function(){return this.transceivers.filter(function(s){return!!s.rtpReceiver}).map(function(s){return s.rtpReceiver})},a.prototype._createIceGatherer=function(s,o){var c=this;if(o&&s>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[s].bufferedCandidateEvents=[],this.transceivers[s].bufferCandidates=function(l){var m=!l.candidate||Object.keys(l.candidate).length===0;d.state=m?"completed":"gathering",c.transceivers[s].bufferedCandidateEvents!==null&&c.transceivers[s].bufferedCandidateEvents.push(l)},d.addEventListener("localcandidate",this.transceivers[s].bufferCandidates),d},a.prototype._gather=function(s,o){var c=this,d=this.transceivers[o].iceGatherer;if(!d.onlocalcandidate){var l=this.transceivers[o].bufferedCandidateEvents;this.transceivers[o].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[o].bufferCandidates),d.onlocalcandidate=function(m){if(!(c.usingBundle&&o>0)){var h=new Event("icecandidate");h.candidate={sdpMid:s,sdpMLineIndex:o};var v=m.candidate,P=!v||Object.keys(v).length===0;if(P)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),v.component=1,v.ufrag=d.getLocalParameters().usernameFragment;var C=y.writeCandidate(v);h.candidate=Object.assign(h.candidate,y.parseCandidate(C)),h.candidate.candidate=C,h.candidate.toJSON=function(){return{candidate:h.candidate.candidate,sdpMid:h.candidate.sdpMid,sdpMLineIndex:h.candidate.sdpMLineIndex,usernameFragment:h.candidate.usernameFragment}}}var S=y.getMediaSections(c._localDescription.sdp);P?S[h.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:S[h.candidate.sdpMLineIndex]+="a="+h.candidate.candidate+`\r
`,c._localDescription.sdp=y.getDescription(c._localDescription.sdp)+S.join("");var F=c.transceivers.every(function(x){return x.iceGatherer&&x.iceGatherer.state==="completed"});c.iceGatheringState!=="gathering"&&(c.iceGatheringState="gathering",c._emitGatheringStateChange()),P||c._dispatchEvent("icecandidate",h),F&&(c._dispatchEvent("icecandidate",new Event("icecandidate")),c.iceGatheringState="complete",c._emitGatheringStateChange())}},e.setTimeout(function(){l.forEach(function(m){d.onlocalcandidate(m)})},0)}},a.prototype._createIceAndDtlsTransports=function(){var s=this,o=new e.RTCIceTransport(null);o.onicestatechange=function(){s._updateIceConnectionState(),s._updateConnectionState()};var c=new e.RTCDtlsTransport(o);return c.ondtlsstatechange=function(){s._updateConnectionState()},c.onerror=function(){Object.defineProperty(c,"state",{value:"failed",writable:!0}),s._updateConnectionState()},{iceTransport:o,dtlsTransport:c}},a.prototype._disposeIceAndDtlsTransports=function(s){var o=this.transceivers[s].iceGatherer;o&&(delete o.onlocalcandidate,delete this.transceivers[s].iceGatherer);var c=this.transceivers[s].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[s].iceTransport);var d=this.transceivers[s].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[s].dtlsTransport)},a.prototype._transceive=function(s,o,c){var d=Te(s.localCapabilities,s.remoteCapabilities);o&&s.rtpSender&&(d.encodings=s.sendEncodingParameters,d.rtcp={cname:y.localCName,compound:s.rtcpParameters.compound},s.recvEncodingParameters.length&&(d.rtcp.ssrc=s.recvEncodingParameters[0].ssrc),s.rtpSender.send(d)),c&&s.rtpReceiver&&d.codecs.length>0&&(s.kind==="video"&&s.recvEncodingParameters&&t<15019&&s.recvEncodingParameters.forEach(function(l){delete l.rtx}),s.recvEncodingParameters.length?d.encodings=s.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:s.rtcpParameters.compound},s.rtcpParameters.cname&&(d.rtcp.cname=s.rtcpParameters.cname),s.sendEncodingParameters.length&&(d.rtcp.ssrc=s.sendEncodingParameters[0].ssrc),s.rtpReceiver.receive(d))},a.prototype.setLocalDescription=function(s){var o=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(I("TypeError",'Unsupported type "'+s.type+'"'));if(!Gt("setLocalDescription",s.type,o.signalingState)||o._isClosed)return Promise.reject(I("InvalidStateError","Can not set local "+s.type+" in state "+o.signalingState));var c,d;if(s.type==="offer")c=y.splitSections(s.sdp),d=c.shift(),c.forEach(function(m,h){var v=y.parseRtpParameters(m);o.transceivers[h].localCapabilities=v}),o.transceivers.forEach(function(m,h){o._gather(m.mid,h)});else if(s.type==="answer"){c=y.splitSections(o._remoteDescription.sdp),d=c.shift();var l=y.matchPrefix(d,"a=ice-lite").length>0;c.forEach(function(m,h){var v=o.transceivers[h],P=v.iceGatherer,C=v.iceTransport,S=v.dtlsTransport,F=v.localCapabilities,x=v.remoteCapabilities,R=y.isRejected(m)&&y.matchPrefix(m,"a=bundle-only").length===0;if(!R&&!v.rejected){var G=y.getIceParameters(m,d),j=y.getDtlsParameters(m,d);l&&(j.role="server"),(!o.usingBundle||h===0)&&(o._gather(v.mid,h),C.state==="new"&&C.start(P,G,l?"controlling":"controlled"),S.state==="new"&&S.start(j));var M=Te(F,x);o._transceive(v,M.codecs.length>0,!1)}})}return o._localDescription={type:s.type,sdp:s.sdp},s.type==="offer"?o._updateSignalingState("have-local-offer"):o._updateSignalingState("stable"),Promise.resolve()},a.prototype.setRemoteDescription=function(s){var o=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(I("TypeError",'Unsupported type "'+s.type+'"'));if(!Gt("setRemoteDescription",s.type,o.signalingState)||o._isClosed)return Promise.reject(I("InvalidStateError","Can not set remote "+s.type+" in state "+o.signalingState));var c={};o.remoteStreams.forEach(function(C){c[C.id]=C});var d=[],l=y.splitSections(s.sdp),m=l.shift(),h=y.matchPrefix(m,"a=ice-lite").length>0,v=y.matchPrefix(m,"a=group:BUNDLE ").length>0;o.usingBundle=v;var P=y.matchPrefix(m,"a=ice-options:")[0];return P?o.canTrickleIceCandidates=P.substr(14).split(" ").indexOf("trickle")>=0:o.canTrickleIceCandidates=!1,l.forEach(function(C,S){var F=y.splitLines(C),x=y.getKind(C),R=y.isRejected(C)&&y.matchPrefix(C,"a=bundle-only").length===0,G=F[0].substr(2).split(" ")[2],j=y.getDirection(C,m),M=y.parseMsid(C),ot=y.getMid(C)||y.generateIdentifier();if(R||x==="application"&&(G==="DTLS/SCTP"||G==="UDP/DTLS/SCTP")){o.transceivers[S]={mid:ot,kind:x,protocol:G,rejected:!0};return}!R&&o.transceivers[S]&&o.transceivers[S].rejected&&(o.transceivers[S]=o._createTransceiver(x,!0));var _,at,se,Oe,V,Ae,Be,oe,J,ct=y.parseRtpParameters(C),pt,Le;R||(pt=y.getIceParameters(C,m),Le=y.getDtlsParameters(C,m),Le.role="client"),Be=y.parseRtpEncodingParameters(C);var ft=y.parseRtcpParameters(C),dt=y.matchPrefix(C,"a=end-of-candidates",m).length>0,Y=y.matchPrefix(C,"a=candidate:").map(function(U){return y.parseCandidate(U)}).filter(function(U){return U.component===1});if((s.type==="offer"||s.type==="answer")&&!R&&v&&S>0&&o.transceivers[S]&&(o._disposeIceAndDtlsTransports(S),o.transceivers[S].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[S].iceTransport=o.transceivers[0].iceTransport,o.transceivers[S].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[S].rtpSender&&o.transceivers[S].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[S].rtpReceiver&&o.transceivers[S].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),s.type==="offer"&&!R){_=o.transceivers[S]||o._createTransceiver(x),_.mid=ot,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(S,v)),Y.length&&_.iceTransport.state==="new"&&(dt&&(!v||S===0)?_.iceTransport.setRemoteCandidates(Y):Y.forEach(function(U){We(_.iceTransport,U)})),oe=e.RTCRtpReceiver.getCapabilities(x),t<15019&&(oe.codecs=oe.codecs.filter(function(U){return U.name!=="rtx"})),Ae=_.sendEncodingParameters||[{ssrc:(2*S+2)*1001}];var Fe=!1;if(j==="sendrecv"||j==="sendonly"){if(Fe=!_.rtpReceiver,V=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,x),Fe){var X;J=V.track,M&&M.stream==="-"||(M?(c[M.stream]||(c[M.stream]=new e.MediaStream,Object.defineProperty(c[M.stream],"id",{get:function(){return M.stream}})),Object.defineProperty(J,"id",{get:function(){return M.track}}),X=c[M.stream]):(c.default||(c.default=new e.MediaStream),X=c.default)),X&&(r(J,X),_.associatedRemoteMediaStreams.push(X)),d.push([J,V,X])}}else _.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(U){var lt=U.getTracks().find(function(Cr){return Cr.id===_.rtpReceiver.track.id});lt&&n(lt,U)}),_.associatedRemoteMediaStreams=[]);_.localCapabilities=oe,_.remoteCapabilities=ct,_.rtpReceiver=V,_.rtcpParameters=ft,_.sendEncodingParameters=Ae,_.recvEncodingParameters=Be,o._transceive(o.transceivers[S],!1,Fe)}else if(s.type==="answer"&&!R){_=o.transceivers[S],at=_.iceGatherer,se=_.iceTransport,Oe=_.dtlsTransport,V=_.rtpReceiver,Ae=_.sendEncodingParameters,oe=_.localCapabilities,o.transceivers[S].recvEncodingParameters=Be,o.transceivers[S].remoteCapabilities=ct,o.transceivers[S].rtcpParameters=ft,Y.length&&se.state==="new"&&((h||dt)&&(!v||S===0)?se.setRemoteCandidates(Y):Y.forEach(function(U){We(_.iceTransport,U)})),(!v||S===0)&&(se.state==="new"&&se.start(at,pt,"controlling"),Oe.state==="new"&&Oe.start(Le));var vr=Te(_.localCapabilities,_.remoteCapabilities),yr=vr.codecs.filter(function(U){return U.name.toLowerCase()==="rtx"}).length;!yr&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,o._transceive(_,j==="sendrecv"||j==="recvonly",j==="sendrecv"||j==="sendonly"),V&&(j==="sendrecv"||j==="sendonly")?(J=V.track,M?(c[M.stream]||(c[M.stream]=new e.MediaStream),r(J,c[M.stream]),d.push([J,V,c[M.stream]])):(c.default||(c.default=new e.MediaStream),r(J,c.default),d.push([J,V,c.default]))):delete _.rtpReceiver}}),o._dtlsRole===void 0&&(o._dtlsRole=s.type==="offer"?"active":"passive"),o._remoteDescription={type:s.type,sdp:s.sdp},s.type==="offer"?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(c).forEach(function(C){var S=c[C];if(S.getTracks().length){if(o.remoteStreams.indexOf(S)===-1){o.remoteStreams.push(S);var F=new Event("addstream");F.stream=S,e.setTimeout(function(){o._dispatchEvent("addstream",F)})}d.forEach(function(x){var R=x[0],G=x[1];S.id===x[2].id&&i(o,R,G,[S])})}}),d.forEach(function(C){C[2]||i(o,C[0],C[1],[])}),e.setTimeout(function(){!(o&&o.transceivers)||o.transceivers.forEach(function(C){C.iceTransport&&C.iceTransport.state==="new"&&C.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),C.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},a.prototype.close=function(){this.transceivers.forEach(function(s){s.iceTransport&&s.iceTransport.stop(),s.dtlsTransport&&s.dtlsTransport.stop(),s.rtpSender&&s.rtpSender.stop(),s.rtpReceiver&&s.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},a.prototype._updateSignalingState=function(s){this.signalingState=s;var o=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",o)},a.prototype._maybeFireNegotiationNeeded=function(){var s=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,e.setTimeout(function(){if(s.needNegotiation){s.needNegotiation=!1;var o=new Event("negotiationneeded");s._dispatchEvent("negotiationneeded",o)}},0))},a.prototype._updateIceConnectionState=function(){var s,o={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&o[d.iceTransport.state]++}),s="new",o.failed>0?s="failed":o.checking>0?s="checking":o.disconnected>0?s="disconnected":o.new>0?s="new":o.connected>0?s="connected":o.completed>0&&(s="completed"),s!==this.iceConnectionState){this.iceConnectionState=s;var c=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",c)}},a.prototype._updateConnectionState=function(){var s,o={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(o[d.iceTransport.state]++,o[d.dtlsTransport.state]++)}),o.connected+=o.completed,s="new",o.failed>0?s="failed":o.connecting>0?s="connecting":o.disconnected>0?s="disconnected":o.new>0?s="new":o.connected>0&&(s="connected"),s!==this.connectionState){this.connectionState=s;var c=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",c)}},a.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(I("InvalidStateError","Can not call createOffer after close"));var o=s.transceivers.filter(function(h){return h.kind==="audio"}).length,c=s.transceivers.filter(function(h){return h.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?o=1:d.offerToReceiveAudio===!1?o=0:o=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?c=1:d.offerToReceiveVideo===!1?c=0:c=d.offerToReceiveVideo)}for(s.transceivers.forEach(function(h){h.kind==="audio"?(o--,o<0&&(h.wantReceive=!1)):h.kind==="video"&&(c--,c<0&&(h.wantReceive=!1))});o>0||c>0;)o>0&&(s._createTransceiver("audio"),o--),c>0&&(s._createTransceiver("video"),c--);var l=y.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(h,v){var P=h.track,C=h.kind,S=h.mid||y.generateIdentifier();h.mid=S,h.iceGatherer||(h.iceGatherer=s._createIceGatherer(v,s.usingBundle));var F=e.RTCRtpSender.getCapabilities(C);t<15019&&(F.codecs=F.codecs.filter(function(R){return R.name!=="rtx"})),F.codecs.forEach(function(R){R.name==="H264"&&R.parameters["level-asymmetry-allowed"]===void 0&&(R.parameters["level-asymmetry-allowed"]="1"),h.remoteCapabilities&&h.remoteCapabilities.codecs&&h.remoteCapabilities.codecs.forEach(function(G){R.name.toLowerCase()===G.name.toLowerCase()&&R.clockRate===G.clockRate&&(R.preferredPayloadType=G.payloadType)})}),F.headerExtensions.forEach(function(R){var G=h.remoteCapabilities&&h.remoteCapabilities.headerExtensions||[];G.forEach(function(j){R.uri===j.uri&&(R.id=j.id)})});var x=h.sendEncodingParameters||[{ssrc:(2*v+1)*1001}];P&&t>=15019&&C==="video"&&!x[0].rtx&&(x[0].rtx={ssrc:x[0].ssrc+1}),h.wantReceive&&(h.rtpReceiver=new e.RTCRtpReceiver(h.dtlsTransport,C)),h.localCapabilities=F,h.sendEncodingParameters=x}),s._config.bundlePolicy!=="max-compat"&&(l+="a=group:BUNDLE "+s.transceivers.map(function(h){return h.mid}).join(" ")+`\r
`),l+=`a=ice-options:trickle\r
`,s.transceivers.forEach(function(h,v){l+=Ut(h,h.localCapabilities,"offer",h.stream,s._dtlsRole),l+=`a=rtcp-rsize\r
`,h.iceGatherer&&s.iceGatheringState!=="new"&&(v===0||!s.usingBundle)&&(h.iceGatherer.getLocalCandidates().forEach(function(P){P.component=1,l+="a="+y.writeCandidate(P)+`\r
`}),h.iceGatherer.state==="completed"&&(l+=`a=end-of-candidates\r
`))});var m=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(m)},a.prototype.createAnswer=function(){var s=this;if(s._isClosed)return Promise.reject(I("InvalidStateError","Can not call createAnswer after close"));if(!(s.signalingState==="have-remote-offer"||s.signalingState==="have-local-pranswer"))return Promise.reject(I("InvalidStateError","Can not call createAnswer in signalingState "+s.signalingState));var o=y.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.usingBundle&&(o+="a=group:BUNDLE "+s.transceivers.map(function(l){return l.mid}).join(" ")+`\r
`),o+=`a=ice-options:trickle\r
`;var c=y.getMediaSections(s._remoteDescription.sdp).length;s.transceivers.forEach(function(l,m){if(!(m+1>c)){if(l.rejected){l.kind==="application"?l.protocol==="DTLS/SCTP"?o+=`m=application 0 DTLS/SCTP 5000\r
`:o+="m=application 0 "+l.protocol+` webrtc-datachannel\r
`:l.kind==="audio"?o+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:l.kind==="video"&&(o+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),o+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+l.mid+`\r
`;return}if(l.stream){var h;l.kind==="audio"?h=l.stream.getAudioTracks()[0]:l.kind==="video"&&(h=l.stream.getVideoTracks()[0]),h&&t>=15019&&l.kind==="video"&&!l.sendEncodingParameters[0].rtx&&(l.sendEncodingParameters[0].rtx={ssrc:l.sendEncodingParameters[0].ssrc+1})}var v=Te(l.localCapabilities,l.remoteCapabilities),P=v.codecs.filter(function(C){return C.name.toLowerCase()==="rtx"}).length;!P&&l.sendEncodingParameters[0].rtx&&delete l.sendEncodingParameters[0].rtx,o+=Ut(l,v,"answer",l.stream,s._dtlsRole),l.rtcpParameters&&l.rtcpParameters.reducedSize&&(o+=`a=rtcp-rsize\r
`)}});var d=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(d)},a.prototype.addIceCandidate=function(s){var o=this,c;return s&&!(s.sdpMLineIndex!==void 0||s.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,l){if(o._remoteDescription)if(!s||s.candidate==="")for(var m=0;m<o.transceivers.length&&!(!o.transceivers[m].rejected&&(o.transceivers[m].iceTransport.addRemoteCandidate({}),c=y.getMediaSections(o._remoteDescription.sdp),c[m]+=`a=end-of-candidates\r
`,o._remoteDescription.sdp=y.getDescription(o._remoteDescription.sdp)+c.join(""),o.usingBundle));m++);else{var h=s.sdpMLineIndex;if(s.sdpMid){for(var v=0;v<o.transceivers.length;v++)if(o.transceivers[v].mid===s.sdpMid){h=v;break}}var P=o.transceivers[h];if(P){if(P.rejected)return d();var C=Object.keys(s.candidate).length>0?y.parseCandidate(s.candidate):{};if(C.protocol==="tcp"&&(C.port===0||C.port===9)||C.component&&C.component!==1)return d();if((h===0||h>0&&P.iceTransport!==o.transceivers[0].iceTransport)&&!We(P.iceTransport,C))return l(I("OperationError","Can not add ICE candidate"));var S=s.candidate.trim();S.indexOf("a=")===0&&(S=S.substr(2)),c=y.getMediaSections(o._remoteDescription.sdp),c[h]+="a="+(C.type?S:"end-of-candidates")+`\r
`,o._remoteDescription.sdp=y.getDescription(o._remoteDescription.sdp)+c.join("")}else return l(I("OperationError","Can not add ICE candidate"))}else return l(I("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},a.prototype.getStats=function(s){if(s&&s instanceof e.MediaStreamTrack){var o=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===s?o=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===s&&(o=d.rtpReceiver)}),!o)throw I("InvalidAccessError","Invalid selector.");return o.getStats()}var c=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(l){d[l]&&c.push(d[l].getStats())})}),Promise.all(c).then(function(d){var l=new Map;return d.forEach(function(m){m.forEach(function(h){l.set(h.id,h)})}),l})};var p=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];p.forEach(function(s){var o=e[s];if(o&&o.prototype&&o.prototype.getStats){var c=o.prototype.getStats;o.prototype.getStats=function(){return c.apply(this).then(function(d){var l=new Map;return Object.keys(d).forEach(function(m){d[m].type=Or(d[m]),l.set(m,d[m])}),l})}}});var f=["createOffer","createAnswer"];return f.forEach(function(s){var o=a.prototype[s];a.prototype[s]=function(){var c=arguments;return typeof c[0]=="function"||typeof c[1]=="function"?o.apply(this,[arguments[2]]).then(function(d){typeof c[0]=="function"&&c[0].apply(null,[d])},function(d){typeof c[1]=="function"&&c[1].apply(null,[d])}):o.apply(this,arguments)}}),f=["setLocalDescription","setRemoteDescription","addIceCandidate"],f.forEach(function(s){var o=a.prototype[s];a.prototype[s]=function(){var c=arguments;return typeof c[1]=="function"||typeof c[2]=="function"?o.apply(this,arguments).then(function(){typeof c[1]=="function"&&c[1].apply(null)},function(d){typeof c[2]=="function"&&c[2].apply(null,[d])}):o.apply(this,arguments)}}),["getStats"].forEach(function(s){var o=a.prototype[s];a.prototype[s]=function(){var c=arguments;return typeof c[1]=="function"?o.apply(this,arguments).then(function(){typeof c[1]=="function"&&c[1].apply(null)}):o.apply(this,arguments)}}),a}});var ge=ce((Rn,et)=>{"use strict";var Lr=Object.prototype.hasOwnProperty,A="~";function me(){}Object.create&&(me.prototype=Object.create(null),new me().__proto__||(A=!1));function Fr(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function dr(e,t,r,n,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var a=new Fr(r,n||e,i),p=A?A+t:t;return e._events[p]?e._events[p].fn?e._events[p]=[e._events[p],a]:e._events[p].push(a):(e._events[p]=a,e._eventsCount++),e}function Me(e,t){--e._eventsCount==0?e._events=new me:delete e._events[t]}function O(){this._events=new me,this._eventsCount=0}O.prototype.eventNames=function(){var t=[],r,n;if(this._eventsCount===0)return t;for(n in r=this._events)Lr.call(r,n)&&t.push(A?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(r)):t};O.prototype.listeners=function(t){var r=A?A+t:t,n=this._events[r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,p=new Array(a);i<a;i++)p[i]=n[i].fn;return p};O.prototype.listenerCount=function(t){var r=A?A+t:t,n=this._events[r];return n?n.fn?1:n.length:0};O.prototype.emit=function(t,r,n,i,a,p){var f=A?A+t:t;if(!this._events[f])return!1;var s=this._events[f],o=arguments.length,c,d;if(s.fn){switch(s.once&&this.removeListener(t,s.fn,void 0,!0),o){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,r),!0;case 3:return s.fn.call(s.context,r,n),!0;case 4:return s.fn.call(s.context,r,n,i),!0;case 5:return s.fn.call(s.context,r,n,i,a),!0;case 6:return s.fn.call(s.context,r,n,i,a,p),!0}for(d=1,c=new Array(o-1);d<o;d++)c[d-1]=arguments[d];s.fn.apply(s.context,c)}else{var l=s.length,m;for(d=0;d<l;d++)switch(s[d].once&&this.removeListener(t,s[d].fn,void 0,!0),o){case 1:s[d].fn.call(s[d].context);break;case 2:s[d].fn.call(s[d].context,r);break;case 3:s[d].fn.call(s[d].context,r,n);break;case 4:s[d].fn.call(s[d].context,r,n,i);break;default:if(!c)for(m=1,c=new Array(o-1);m<o;m++)c[m-1]=arguments[m];s[d].fn.apply(s[d].context,c)}}return!0};O.prototype.on=function(t,r,n){return dr(this,t,r,n,!1)};O.prototype.once=function(t,r,n){return dr(this,t,r,n,!0)};O.prototype.removeListener=function(t,r,n,i){var a=A?A+t:t;if(!this._events[a])return this;if(!r)return Me(this,a),this;var p=this._events[a];if(p.fn)p.fn===r&&(!i||p.once)&&(!n||p.context===n)&&Me(this,a);else{for(var f=0,s=[],o=p.length;f<o;f++)(p[f].fn!==r||i&&!p[f].once||n&&p[f].context!==n)&&s.push(p[f]);s.length?this._events[a]=s.length===1?s[0]:s:Me(this,a)}return this};O.prototype.removeAllListeners=function(t){var r;return t?(r=A?A+t:t,this._events[r]&&Me(this,r)):(this._events=new me,this._eventsCount=0),this};O.prototype.off=O.prototype.removeListener;O.prototype.addListener=O.prototype.on;O.prefixed=A;O.EventEmitter=O;typeof et!="undefined"&&(et.exports=O)});var De=H(St());"use strict";var _t=!0,bt=!0;function ee(e,t,r){let n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function W(e,t,r){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(p,f){if(p!==t)return i.apply(this,arguments);let s=o=>{let c=r(o);c&&(f.handleEvent?f.handleEvent(c):f(c))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(f,s),i.apply(this,[p,s])};let a=n.removeEventListener;n.removeEventListener=function(p,f){if(p!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(f))return a.apply(this,arguments);let s=this._eventMap[t].get(f);return this._eventMap[t].delete(f),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[p,s])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(p){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),p&&this.addEventListener(t,this["_on"+t]=p)},enumerable:!0,configurable:!0})}function Tt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(_t=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Rt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(bt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function te(){if(typeof window=="object"){if(_t)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function q(e,t){!bt||console.warn(e+" is deprecated, please use "+t+" instead.")}function kt(e){let t={browser:null,version:null};if(typeof e=="undefined"||!e.navigator)return t.browser="Not a browser.",t;let{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=ee(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=ee(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=ee(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=ee(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Pt(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ue(e){return Pt(e)?Object.keys(e).reduce(function(t,r){let n=Pt(e[r]),i=n?Ue(e[r]):e[r],a=n&&!Object.keys(i).length;return i===void 0||a?t:Object.assign(t,{[r]:i})},{}):e}function Ge(e,t,r){!t||r.has(t.id)||(r.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?Ge(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(i=>{Ge(e,e.get(i),r)})}))}function Ne(e,t,r){let n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;let a=[];return e.forEach(p=>{p.type==="track"&&p.trackIdentifier===t.id&&a.push(p)}),a.forEach(p=>{e.forEach(f=>{f.type===n&&f.trackId===p.id&&Ge(e,f,i)})}),i}var be={};pe(be,{fixNegotiationNeeded:()=>Ft,shimAddTrackRemoveTrack:()=>Lt,shimAddTrackRemoveTrackWithNative:()=>Bt,shimGetDisplayMedia:()=>Et,shimGetSendersWithDtmf:()=>It,shimGetStats:()=>Ot,shimGetUserMedia:()=>ze,shimMediaStream:()=>Dt,shimOnTrack:()=>Mt,shimPeerConnection:()=>$e,shimSenderReceiverGetStats:()=>At});"use strict";var xt=te;function ze(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let n=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;let s={};return Object.keys(f).forEach(o=>{if(o==="require"||o==="advanced"||o==="mediaSource")return;let c=typeof f[o]=="object"?f[o]:{ideal:f[o]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);let d=function(l,m){return l?l+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(c.ideal!==void 0){s.optional=s.optional||[];let l={};typeof c.ideal=="number"?(l[d("min",o)]=c.ideal,s.optional.push(l),l={},l[d("max",o)]=c.ideal,s.optional.push(l)):(l[d("",o)]=c.ideal,s.optional.push(l))}c.exact!==void 0&&typeof c.exact!="number"?(s.mandatory=s.mandatory||{},s.mandatory[d("",o)]=c.exact):["min","max"].forEach(l=>{c[l]!==void 0&&(s.mandatory=s.mandatory||{},s.mandatory[d(l,o)]=c[l])})}),f.advanced&&(s.optional=(s.optional||[]).concat(f.advanced)),s},i=function(f,s){if(t.version>=61)return s(f);if(f=JSON.parse(JSON.stringify(f)),f&&typeof f.audio=="object"){let o=function(c,d,l){d in c&&!(l in c)&&(c[l]=c[d],delete c[d])};f=JSON.parse(JSON.stringify(f)),o(f.audio,"autoGainControl","googAutoGainControl"),o(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=n(f.audio)}if(f&&typeof f.video=="object"){let o=f.video.facingMode;o=o&&(typeof o=="object"?o:{ideal:o});let c=t.version<66;if(o&&(o.exact==="user"||o.exact==="environment"||o.ideal==="user"||o.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete f.video.facingMode;let d;if(o.exact==="environment"||o.ideal==="environment"?d=["back","rear"]:(o.exact==="user"||o.ideal==="user")&&(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(l=>{l=l.filter(h=>h.kind==="videoinput");let m=l.find(h=>d.some(v=>h.label.toLowerCase().includes(v)));return!m&&l.length&&d.includes("back")&&(m=l[l.length-1]),m&&(f.video.deviceId=o.exact?{exact:m.deviceId}:{ideal:m.deviceId}),f.video=n(f.video),xt("chrome: "+JSON.stringify(f)),s(f)})}f.video=n(f.video)}return xt("chrome: "+JSON.stringify(f)),s(f)},a=function(f){return t.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},p=function(f,s,o){i(f,c=>{r.webkitGetUserMedia(c,s,d=>{o&&o(a(d))})})};if(r.getUserMedia=p.bind(r),r.mediaDevices.getUserMedia){let f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(s){return i(s,o=>f(o).then(c=>{if(o.audio&&!c.getAudioTracks().length||o.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(a(c))))}}}"use strict";function Et(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{let a=n.video&&n.video.width,p=n.video&&n.video.height,f=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:f||3}},a&&(n.video.mandatory.maxWidth=a),p&&(n.video.mandatory.maxHeight=p),e.navigator.mediaDevices.getUserMedia(n)})}}}"use strict";function Dt(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Mt(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(f=>f.track&&f.track.id===i.track.id):a={track:i.track};let p=new Event("track");p.track=i.track,p.receiver=a,p.transceiver={receiver:a},p.streams=[n.stream],this.dispatchEvent(p)}),n.stream.getTracks().forEach(i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(f=>f.track&&f.track.id===i.id):a={track:i};let p=new Event("track");p.track=i,p.receiver=a,p.transceiver={receiver:a},p.streams=[n.stream],this.dispatchEvent(p)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else W(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function It(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(f,s){let o=i.apply(this,arguments);return o||(o=t(this,f),this._senders.push(o)),o};let a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(f){a.apply(this,arguments);let s=this._senders.indexOf(f);s!==-1&&this._senders.splice(s,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach(p=>{this._senders.push(t(this,p))})};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(p=>{let f=this._senders.find(s=>s.track===p);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ot(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);let p=function(s){let o={};return s.result().forEach(d=>{let l={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(m=>{l[m]=d.stat(m)}),o[l.id]=l}),o},f=function(s){return new Map(Object.keys(s).map(o=>[o,s[o]]))};if(arguments.length>=2){let s=function(o){i(f(p(o)))};return t.apply(this,[s,n])}return new Promise((s,o)=>{t.apply(this,[function(c){s(f(p(c)))},o])}).then(i,a)}}function At(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let a=r.apply(this,[]);return a.forEach(p=>p._pc=this),a});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let a=n.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){let a=this;return this._pc.getStats().then(p=>Ne(p,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=r.apply(this,[]);return i.forEach(a=>a._pc=this),i}),W(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){let i=this;return this._pc.getStats().then(a=>Ne(a,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let n=arguments[0],i,a,p;return this.getSenders().forEach(f=>{f.track===n&&(i?p=!0:i=f)}),this.getReceivers().forEach(f=>(f.track===n&&(a?p=!0:a=f),f.track===n)),p||i&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Bt(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(p=>this._shimmedLocalStreams[p][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(p,f){if(!f)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let s=t.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(s)===-1&&this._shimmedLocalStreams[f.id].push(s):this._shimmedLocalStreams[f.id]=[f,s],s};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){this._shimmedLocalStreams=this._shimmedLocalStreams||{},p.getTracks().forEach(o=>{if(this.getSenders().find(d=>d.track===o))throw new DOMException("Track already exists.","InvalidAccessError")});let f=this.getSenders();r.apply(this,arguments);let s=this.getSenders().filter(o=>f.indexOf(o)===-1);this._shimmedLocalStreams[p.id]=[p].concat(s)};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(p){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[p.id],n.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(p){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},p&&Object.keys(this._shimmedLocalStreams).forEach(f=>{let s=this._shimmedLocalStreams[f].indexOf(p);s!==-1&&this._shimmedLocalStreams[f].splice(s,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),i.apply(this,arguments)}}function Lt(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Bt(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(d=>this._reverseStreams[d.id])};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(d=>{if(this.getSenders().find(m=>m.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){let d=new e.MediaStream(c.getTracks());this._streams[c.id]=d,this._reverseStreams[d.id]=c,c=d}n.apply(this,[c])};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find(v=>v===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let h=this._streams[d.id];if(h)h.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let v=new e.MediaStream([c]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===c)};function a(o,c){let d=c.sdp;return Object.keys(o._reverseStreams||[]).forEach(l=>{let m=o._reverseStreams[l],h=o._streams[m.id];d=d.replace(new RegExp(h.id,"g"),m.id)}),new RTCSessionDescription({type:c.type,sdp:d})}function p(o,c){let d=c.sdp;return Object.keys(o._reverseStreams||[]).forEach(l=>{let m=o._reverseStreams[l],h=o._streams[m.id];d=d.replace(new RegExp(m.id,"g"),h.id)}),new RTCSessionDescription({type:c.type,sdp:d})}["createOffer","createAnswer"].forEach(function(o){let c=e.RTCPeerConnection.prototype[o],d={[o](){let l=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[h=>{let v=a(this,h);l[0].apply(null,[v])},h=>{l[1]&&l[1].apply(null,h)},arguments[2]]):c.apply(this,arguments).then(h=>a(this,h))}};e.RTCPeerConnection.prototype[o]=d[o]});let f=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?f.apply(this,arguments):(arguments[0]=p(this,arguments[0]),f.apply(this,arguments))};let s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let o=s.get.apply(this);return o.type===""?o:a(this,o)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let l;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(v=>c.track===v)&&(l=this._streams[m])}),l&&(l.getTracks().length===1?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $e(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let n=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}function Ft(e,t){W(e,"negotiationneeded",r=>{let n=r.target;if(!((t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return r})}var Re={};pe(Re,{shimGetDisplayMedia:()=>Qe,shimGetUserMedia:()=>Ke,shimPeerConnection:()=>qe,shimReplaceTrack:()=>Vt});"use strict";function jt(e,t){let r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&q("RTCIceServer.url","RTCIceServer.urls");let a=typeof i=="string";return a&&(i=[i]),i=i.filter(p=>{if(p.indexOf("stun:")===0)return!1;let f=p.startsWith("turn")&&!p.startsWith("turn:[")&&p.includes("transport=udp");return f&&!r?(r=!0,!0):f&&!r}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}var $t=H(zt());"use strict";function Ke(e){let t=e&&e.navigator,r=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(i){return n(i).catch(a=>Promise.reject(r(a)))}}"use strict";function Qe(e){"getDisplayMedia"in e.navigator&&(!e.navigator.mediaDevices||e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}"use strict";function qe(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(i){return i}),e.RTCSessionDescription||(e.RTCSessionDescription=function(i){return i}),t.version<15025)){let n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);let a=new Event("enabled");a.enabled=i,this.dispatchEvent(a)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);let r=(0,$t.default)(e,t.version);e.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=jt(i.iceServers,t.version),te("ICE servers after filtering:",i.iceServers)),new r(i)},e.RTCPeerConnection.prototype=r.prototype}function Vt(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var ke={};pe(ke,{shimAddTransceiver:()=>Yt,shimCreateAnswer:()=>wt,shimCreateOffer:()=>Zt,shimGetDisplayMedia:()=>Jt,shimGetParameters:()=>Xt,shimGetUserMedia:()=>He,shimOnTrack:()=>Wt,shimPeerConnection:()=>Ye,shimRTCDataChannel:()=>Ht,shimReceiverGetStats:()=>Qt,shimRemoveStream:()=>qt,shimSenderGetStats:()=>Kt});"use strict";function He(e,t){let r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,a,p){q("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(a,p)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let i=function(p,f,s){f in p&&!(s in p)&&(p[s]=p[f],delete p[f])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(JSON.stringify(p)),i(p.audio,"autoGainControl","mozAutoGainControl"),i(p.audio,"noiseSuppression","mozNoiseSuppression")),a(p)},n&&n.prototype.getSettings){let p=n.prototype.getSettings;n.prototype.getSettings=function(){let f=p.apply(this,arguments);return i(f,"mozAutoGainControl","autoGainControl"),i(f,"mozNoiseSuppression","noiseSuppression"),f}}if(n&&n.prototype.applyConstraints){let p=n.prototype.applyConstraints;n.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),i(f,"autoGainControl","mozAutoGainControl"),i(f,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[f])}}}}"use strict";function Jt(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){let i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}"use strict";function Wt(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ye(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let a=e.RTCPeerConnection.prototype[i],p={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=p[i]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[a,p,f]=arguments;return n.apply(this,[a||null]).then(s=>{if(t.version<53&&!p)try{s.forEach(o=>{o.type=r[o.type]||o.type})}catch(o){if(o.name!=="TypeError")throw o;s.forEach((c,d)=>{s.set(d,Object.assign({},c,{type:r[c.type]||c.type}))})}return s}).then(p,f)}}function Kt(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Qt(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),W(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function qt(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){q("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&r.getTracks().includes(n.track)&&this.removeTrack(n)})})}function Ht(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Yt(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(p=>{if("rid"in p&&!/^[a-z0-9]{0,16}$/i.test(p.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in p&&!(parseFloat(p.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in p&&!(parseFloat(p.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let a=t.apply(this,arguments);if(i){let{sender:p}=a,f=p.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=n.sendEncodings,p.sendEncodings=n.sendEncodings,this.setParametersPromises.push(p.setParameters(f).then(()=>{delete p.sendEncodings}).catch(()=>{delete p.sendEncodings})))}return a})}function Xt(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Zt(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function wt(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Pe={};pe(Pe,{shimAudioContext:()=>cr,shimCallbacksAPI:()=>rr,shimConstraints:()=>ir,shimCreateOfferLegacy:()=>ar,shimGetUserMedia:()=>nr,shimLocalStreamsAPI:()=>er,shimRTCIceServerUrls:()=>sr,shimRemoteStreamsAPI:()=>tr,shimTrackEventTransceiver:()=>or});"use strict";function er(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);let n=this._localStreams.indexOf(r);if(n===-1)return;this._localStreams.splice(n,1);let i=r.getTracks();this.getSenders().forEach(a=>{i.includes(a.track)&&this.removeTrack(a)})})}}function tr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);let a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);let p=new Event("addstream");p.stream=a,n.dispatchEvent(p)})}),t.apply(n,arguments)}}}function rr(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,p=t.addIceCandidate;t.createOffer=function(o,c){let d=arguments.length>=2?arguments[2]:arguments[0],l=r.apply(this,[d]);return c?(l.then(o,c),Promise.resolve()):l},t.createAnswer=function(o,c){let d=arguments.length>=2?arguments[2]:arguments[0],l=n.apply(this,[d]);return c?(l.then(o,c),Promise.resolve()):l};let f=function(s,o,c){let d=i.apply(this,[s]);return c?(d.then(o,c),Promise.resolve()):d};t.setLocalDescription=f,f=function(s,o,c){let d=a.apply(this,[s]);return c?(d.then(o,c),Promise.resolve()):d},t.setRemoteDescription=f,f=function(s,o,c){let d=p.apply(this,[s]);return c?(d.then(o,c),Promise.resolve()):d},t.addIceCandidate=f}function nr(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=i=>n(ir(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,a){t.mediaDevices.getUserMedia(n).then(i,a)}.bind(t))}function ir(e){return e&&e.video!==void 0?Object.assign({},e,{video:Ue(e.video)}):e}function sr(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){let a=[];for(let p=0;p<n.iceServers.length;p++){let f=n.iceServers[p];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(q("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,a.push(f)):a.push(n.iceServers[p])}n.iceServers=a}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function or(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ar(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio!="undefined"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);let i=this.getTransceivers().find(p=>p.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo!="undefined"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);let a=this.getTransceivers().find(p=>p.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video")}return t.apply(this,arguments)}}function cr(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var we={};pe(we,{removeExtmapAllowMixed:()=>Ze,shimAddIceCandidateNullOrEmpty:()=>Ee,shimConnectionState:()=>Xe,shimMaxMessageSize:()=>le,shimRTCIceCandidate:()=>xe,shimSendThrowTypeError:()=>ue});var de=H(Je());"use strict";function xe(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){let i=new t(n),a=de.default.parseCandidate(n.candidate),p=Object.assign(i,a);return p.toJSON=function(){return{candidate:p.candidate,sdpMid:p.sdpMid,sdpMLineIndex:p.sdpMLineIndex,usernameFragment:p.usernameFragment}},p}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,W(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function le(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp}});let r=function(f){if(!f||!f.sdp)return!1;let s=de.default.splitSections(f.sdp);return s.shift(),s.some(o=>{let c=de.default.parseMLine(o);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},n=function(f){let s=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;let o=parseInt(s[1],10);return o!==o?-1:o},i=function(f){let s=65536;return t.browser==="firefox"&&(t.version<57?f===-1?s=16384:s=2147483637:t.version<60?s=t.version===57?65535:65536:s=2147483637),s},a=function(f,s){let o=65536;t.browser==="firefox"&&t.version===57&&(o=65535);let c=de.default.matchPrefix(f.sdp,"a=max-message-size:");return c.length>0?o=parseInt(c[0].substr(19),10):t.browser==="firefox"&&s!==-1&&(o=2147483637),o},p=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let s=n(arguments[0]),o=i(s),c=a(arguments[0],s),d;o===0&&c===0?d=Number.POSITIVE_INFINITY:o===0||c===0?d=Math.max(o,c):d=Math.min(o,c);let l={};Object.defineProperty(l,"maxMessageSize",{get(){return d}}),this._sctp=l}return p.apply(this,arguments)}}function ue(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){let a=n.send;n.send=function(){let f=arguments[0],s=f.length||f.size||f.byteLength;if(n.readyState==="open"&&i.sctp&&s>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(n,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let i=r.apply(this,arguments);return t(i,this),i},W(e,"datachannel",n=>(t(n.channel,n.target),n))}function Xe(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let n=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{let a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;let p=new Event("connectionstatechange",i);a.dispatchEvent(p)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Ze(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let a=i.sdp.split(`
`).filter(p=>p.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return r.apply(this,arguments)}}function Ee(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function pr({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let r=te,n=kt(e),i={browserDetails:n,commonShim:we,extractVersion:ee,disableLog:Tt,disableWarnings:Rt};switch(n.browser){case"chrome":if(!be||!$e||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=be,Ee(e,n),ze(e,n),Dt(e,n),$e(e,n),Mt(e,n),Lt(e,n),It(e,n),Ot(e,n),At(e,n),Ft(e,n),xe(e,n),Xe(e,n),le(e,n),ue(e,n),Ze(e,n);break;case"firefox":if(!ke||!Ye||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=ke,Ee(e,n),He(e,n),Ye(e,n),Wt(e,n),qt(e,n),Kt(e,n),Qt(e,n),Ht(e,n),Yt(e,n),Xt(e,n),Zt(e,n),wt(e,n),xe(e,n),Xe(e,n),le(e,n),ue(e,n);break;case"edge":if(!Re||!qe||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),i.browserShim=Re,Ke(e,n),Qe(e,n),qe(e,n),Vt(e,n),le(e,n),ue(e,n);break;case"safari":if(!Pe||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=Pe,Ee(e,n),sr(e,n),ar(e,n),rr(e,n),er(e,n),tr(e,n),or(e,n),nr(e,n),cr(e,n),xe(e,n),le(e,n),ue(e,n),Ze(e,n);break;default:r("Unsupported browser!");break}return i}"use strict";var Br=pr({window:typeof window=="undefined"?void 0:window}),he=Br;var re=new class{constructor(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform);this.supportedBrowsers=["firefox","chrome","safari"];this.minFirefoxVersion=59;this.minChromeVersion=72;this.minSafariVersion=605}isWebRTCSupported(){return typeof RTCPeerConnection!="undefined"}isBrowserSupported(){let e=this.getBrowser(),t=this.getVersion();return this.supportedBrowsers.includes(e)?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1}getBrowser(){return he.browserDetails.browser}getVersion(){return he.browserDetails.version||0}isUnifiedPlanSupported(){let e=this.getBrowser(),t=he.browserDetails.version||0;if(e==="chrome"&&t<72)return!1;if(e==="firefox"&&t>=59)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let r,n=!1;try{r=new RTCPeerConnection,r.addTransceiver("audio"),n=!0}catch(i){}finally{r&&r.close()}return n}toString(){return`Supports: 
    browser:${this.getBrowser()} 
    version:${this.getVersion()} 
    isIOS:${this.isIOS} 
    isWebRTCSupported:${this.isWebRTCSupported()} 
    isBrowserSupported:${this.isBrowserSupported()} 
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}};var fr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},b=new class{constructor(){this.CLOUD_HOST="0.peerjs.com";this.CLOUD_PORT=443;this.chunkedBrowsers={Chrome:1,chrome:1};this.chunkedMTU=16300;this.defaultConfig=fr;this.browser=re.getBrowser();this.browserVersion=re.getVersion();this.supports=function(){let e={browser:re.isBrowserSupported(),webRTC:re.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;let t;try{t=new RTCPeerConnection(fr),e.audioVideo=!0;let r;try{r=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!r.ordered;try{r.binaryType="blob",e.binaryBlob=!re.isIOS}catch(n){}}catch(n){}finally{r&&r.close()}}catch(r){}finally{t&&t.close()}return e}();this.pack=De.pack;this.unpack=De.unpack;this._dataCount=1}noop(){}validateId(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)}chunk(e){let t=[],r=e.size,n=Math.ceil(r/b.chunkedMTU),i=0,a=0;for(;a<r;){let p=Math.min(r,a+b.chunkedMTU),f=e.slice(a,p),s={__peerData:this._dataCount,n:i,data:f,total:n};t.push(s),a=p,i++}return this._dataCount++,t}blobToArrayBuffer(e,t){let r=new FileReader;return r.onload=function(n){n.target&&t(n.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}randomToken(){return Math.random().toString(36).substr(2)}isSecure(){return location.protocol==="https:"}};var gr=H(ge());var jr="PeerJS: ",N;(function(i){i[i.Disabled=0]="Disabled",i[i.Errors=1]="Errors",i[i.Warnings=2]="Warnings",i[i.All=3]="All"})(N||(N={}));var lr=class{constructor(){this._logLevel=0}get logLevel(){return this._logLevel}set logLevel(t){this._logLevel=t}log(...t){this._logLevel>=3&&this._print(3,...t)}warn(...t){this._logLevel>=2&&this._print(2,...t)}error(...t){this._logLevel>=1&&this._print(1,...t)}setLogFunction(t){this._print=t}_print(t,...r){let n=[jr,...r];for(let i in n)n[i]instanceof Error&&(n[i]="("+n[i].name+") "+n[i].message);t>=3?console.log(...n):t>=2?console.warn("WARNING",...n):t>=1&&console.error("ERROR",...n)}},g=new lr;var ur=H(ge());var B;(function(p){p.Open="open",p.Stream="stream",p.Data="data",p.Close="close",p.Error="error",p.IceStateChanged="iceStateChanged"})(B||(B={}));var L;(function(r){r.Data="data",r.Media="media"})(L||(L={}));var K;(function(p){p.Open="open",p.Close="close",p.Connection="connection",p.Call="call",p.Disconnected="disconnected",p.Error="error"})(K||(K={}));var T;(function(l){l.BrowserIncompatible="browser-incompatible",l.Disconnected="disconnected",l.InvalidID="invalid-id",l.InvalidKey="invalid-key",l.Network="network",l.PeerUnavailable="peer-unavailable",l.SslUnavailable="ssl-unavailable",l.ServerError="server-error",l.SocketError="socket-error",l.SocketClosed="socket-closed",l.UnavailableID="unavailable-id",l.WebRTC="webrtc"})(T||(T={}));var $;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})($||($={}));var z;(function(i){i.Message="message",i.Disconnected="disconnected",i.Error="error",i.Close="close"})(z||(z={}));var k;(function(c){c.Heartbeat="HEARTBEAT",c.Candidate="CANDIDATE",c.Offer="OFFER",c.Answer="ANSWER",c.Open="OPEN",c.Error="ERROR",c.IdTaken="ID-TAKEN",c.InvalidKey="INVALID-KEY",c.Leave="LEAVE",c.Expire="EXPIRE"})(k||(k={}));var tt=class extends ur.EventEmitter{constructor(t,r,n,i,a,p=5e3){super();this.pingInterval=p;this._disconnected=!0;this._messagesQueue=[];let f=t?"wss://":"ws://";this._baseUrl=f+r+":"+n+i+"peerjs?key="+a}start(t,r){this._id=t;let n=`${this._baseUrl}&id=${t}&token=${r}`;!!this._socket||!this._disconnected||(this._socket=new WebSocket(n),this._disconnected=!1,this._socket.onmessage=i=>{let a;try{a=JSON.parse(i.data),g.log("Server message received:",a)}catch(p){g.log("Invalid server message",i.data);return}this.emit(z.Message,a)},this._socket.onclose=i=>{this._disconnected||(g.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(z.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),g.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){g.log("Cannot send heartbeat, because socket closed");return}let t=JSON.stringify({type:k.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){let t=[...this._messagesQueue];this._messagesQueue=[];for(let r of t)this.send(r)}send(t){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(z.Error,"Invalid message");return}if(!this._wsOpen())return;let r=JSON.stringify(t);this._socket.send(r)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}};var ve=class{constructor(t){this.connection=t}startConnection(t){let r=this._startPeerConnection();if(this.connection.peerConnection=r,this.connection.type===L.Media&&t._stream&&this._addTracksToConnection(t._stream,r),t.originator){if(this.connection.type===L.Data){let n=this.connection,i={ordered:!!t.reliable},a=r.createDataChannel(n.label,i);n.initialize(a)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)}_startPeerConnection(){g.log("Creating RTCPeerConnection.");let t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t}_setupListeners(t){let r=this.connection.peer,n=this.connection.connectionId,i=this.connection.type,a=this.connection.provider;g.log("Listening for ICE candidates."),t.onicecandidate=p=>{!p.candidate||!p.candidate.candidate||(g.log(`Received ICE candidates for ${r}:`,p.candidate),a.socket.send({type:k.Candidate,payload:{candidate:p.candidate,type:i,connectionId:n},dst:r}))},t.oniceconnectionstatechange=()=>{switch(t.iceConnectionState){case"failed":g.log("iceConnectionState is failed, closing connections to "+r),this.connection.emit(B.Error,new Error("Negotiation of connection to "+r+" failed.")),this.connection.close();break;case"closed":g.log("iceConnectionState is closed, closing connections to "+r),this.connection.emit(B.Error,new Error("Connection to "+r+" closed.")),this.connection.close();break;case"disconnected":g.log("iceConnectionState changed to disconnected on the connection with "+r);break;case"completed":t.onicecandidate=b.noop;break}this.connection.emit(B.IceStateChanged,t.iceConnectionState)},g.log("Listening for data channel"),t.ondatachannel=p=>{g.log("Received data channel");let f=p.channel;a.getConnection(r,n).initialize(f)},g.log("Listening for remote stream"),t.ontrack=p=>{g.log("Received remote stream");let f=p.streams[0],s=a.getConnection(r,n);if(s.type===L.Media){let o=s;this._addStreamToMediaConnection(f,o)}}}cleanup(){g.log("Cleaning up PeerConnection to "+this.connection.peer);let t=this.connection.peerConnection;if(!t)return;this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=()=>{};let r=t.signalingState!=="closed",n=!1;if(this.connection.type===L.Data){let a=this.connection.dataChannel;a&&(n=!!a.readyState&&a.readyState!=="closed")}(r||n)&&t.close()}_makeOffer(){return Q(this,null,function*(){let t=this.connection.peerConnection,r=this.connection.provider;try{let n=yield t.createOffer(this.connection.options.constraints);g.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{yield t.setLocalDescription(n),g.log("Set localDescription:",n,`for:${this.connection.peer}`);let i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:b.browser};if(this.connection.type===L.Data){let a=this.connection;i=Se(Z({},i),{label:a.label,reliable:a.reliable,serialization:a.serialization})}r.socket.send({type:k.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(r.emitError(T.WebRTC,i),g.log("Failed to setLocalDescription, ",i))}}catch(n){r.emitError(T.WebRTC,n),g.log("Failed to createOffer, ",n)}})}_makeAnswer(){return Q(this,null,function*(){let t=this.connection.peerConnection,r=this.connection.provider;try{let n=yield t.createAnswer();g.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{yield t.setLocalDescription(n),g.log("Set localDescription:",n,`for:${this.connection.peer}`),r.socket.send({type:k.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:b.browser},dst:this.connection.peer})}catch(i){r.emitError(T.WebRTC,i),g.log("Failed to setLocalDescription, ",i)}}catch(n){r.emitError(T.WebRTC,n),g.log("Failed to create answer, ",n)}})}handleSDP(t,r){return Q(this,null,function*(){r=new RTCSessionDescription(r);let n=this.connection.peerConnection,i=this.connection.provider;g.log("Setting remote description",r);let a=this;try{yield n.setRemoteDescription(r),g.log(`Set remoteDescription:${t} for:${this.connection.peer}`),t==="OFFER"&&(yield a._makeAnswer())}catch(p){i.emitError(T.WebRTC,p),g.log("Failed to setRemoteDescription, ",p)}})}handleCandidate(t){return Q(this,null,function*(){g.log("handleCandidate:",t);let r=t.candidate,n=t.sdpMLineIndex,i=t.sdpMid,a=this.connection.peerConnection,p=this.connection.provider;try{yield a.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:r})),g.log(`Added ICE candidate for:${this.connection.peer}`)}catch(f){p.emitError(T.WebRTC,f),g.log("Failed to handleCandidate, ",f)}})}_addTracksToConnection(t,r){if(g.log(`add tracks from stream ${t.id} to peer connection`),!r.addTrack)return g.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(n=>{r.addTrack(n,t)})}_addStreamToMediaConnection(t,r){g.log(`add stream ${t.id} to media connection ${r.connectionId}`),r.addStream(t)}};var hr=H(ge()),ye=class extends hr.EventEmitter{constructor(t,r,n){super();this.peer=t;this.provider=r;this.options=n;this._open=!1;this.metadata=n.metadata}get open(){return this._open}};var rt=class extends ye{get type(){return L.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(t,r,n){super(t,r,n);this._localStream=this.options._stream,this.connectionId=this.options.connectionId||rt.ID_PREFIX+b.randomToken(),this._negotiator=new ve(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}addStream(t){g.log("Receiving stream",t),this._remoteStream=t,super.emit(B.Stream,t)}handleMessage(t){let r=t.type,n=t.payload;switch(t.type){case k.Answer:this._negotiator.handleSDP(r,n.sdp),this._open=!0;break;case k.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:g.warn(`Unrecognized message type:${r} from peer:${this.peer}`);break}}answer(t,r={}){if(this._localStream){g.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,r&&r.sdpTransform&&(this.options.sdpTransform=r.sdpTransform),this._negotiator.startConnection(Se(Z({},this.options._payload),{_stream:t}));let n=this.provider._getMessages(this.connectionId);for(let i of n)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),!!this.open&&(this._open=!1,super.emit(B.Close))}},Ce=rt;Ce.ID_PREFIX="mc_";var mr=H(ge());var nt=class extends mr.EventEmitter{constructor(){super();this.fileReader=new FileReader;this._queue=[];this._processing=!1;this.fileReader.onload=t=>{this._processing=!1,t.target&&this.emit("done",t.target.result),this.doNextTask()},this.fileReader.onerror=t=>{g.error("EncodingQueue error:",t),this._processing=!1,this.destroy(),this.emit("error",t)}}get queue(){return this._queue}get size(){return this.queue.length}get processing(){return this._processing}enque(t){this.queue.push(t),!this.processing&&this.doNextTask()}destroy(){this.fileReader.abort(),this._queue=[]}doNextTask(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))}};var Ie=class extends ye{constructor(t,r,n){super(t,r,n);this.stringify=JSON.stringify;this.parse=JSON.parse;this._buffer=[];this._bufferSize=0;this._buffering=!1;this._chunkedData={};this._encodingQueue=new nt;this.connectionId=this.options.connectionId||Ie.ID_PREFIX+b.randomToken(),this.label=this.options.label||this.connectionId,this.serialization=this.options.serialization||$.Binary,this.reliable=!!this.options.reliable,this._encodingQueue.on("done",i=>{this._bufferedSend(i)}),this._encodingQueue.on("error",()=>{g.error(`DC#${this.connectionId}: Error occured in encoding from blob to arraybuffer, close DC`),this.close()}),this._negotiator=new ve(this),this._negotiator.startConnection(this.options._payload||{originator:!0})}get type(){return L.Data}get dataChannel(){return this._dc}get bufferSize(){return this._bufferSize}initialize(t){this._dc=t,this._configureDataChannel()}_configureDataChannel(){(!b.supports.binaryBlob||b.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=()=>{g.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit(B.Open)},this.dataChannel.onmessage=t=>{g.log(`DC#${this.connectionId} dc onmessage:`,t.data),this._handleDataMessage(t)},this.dataChannel.onclose=()=>{g.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}_handleDataMessage({data:t}){let r=t.constructor,n=this.serialization===$.Binary||this.serialization===$.BinaryUTF8,i=t;if(n){if(r===Blob){b.blobToArrayBuffer(t,a=>{let p=b.unpack(a);this.emit(B.Data,p)});return}else if(r===ArrayBuffer)i=b.unpack(t);else if(r===String){let a=b.binaryStringToArrayBuffer(t);i=b.unpack(a)}}else this.serialization===$.JSON&&(i=this.parse(t));if(i.__peerData){this._handleChunk(i);return}super.emit(B.Data,i)}_handleChunk(t){let r=t.__peerData,n=this._chunkedData[r]||{data:[],count:0,total:t.total};if(n.data[t.n]=t.data,n.count++,this._chunkedData[r]=n,n.total===n.count){delete this._chunkedData[r];let i=new Blob(n.data);this._handleDataMessage({data:i})}}close(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),!!this.open&&(this._open=!1,super.emit(B.Close))}send(t,r){if(!this.open){super.emit(B.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===$.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===$.Binary||this.serialization===$.BinaryUTF8){let n=b.pack(t);if(!r&&n.size>b.chunkedMTU){this._sendChunks(n);return}b.supports.binaryBlob?this._bufferedSend(n):this._encodingQueue.enque(n)}else this._bufferedSend(t)}_bufferedSend(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)}_trySend(t){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Ie.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(r){return g.error(`DC#:${this.connectionId} Error when sending:`,r),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;let t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}_sendChunks(t){let r=b.chunk(t);g.log(`DC#${this.connectionId} Try to send ${r.length} chunks...`);for(let n of r)this.send(n,!0)}handleMessage(t){let r=t.payload;switch(t.type){case k.Answer:this._negotiator.handleSDP(t.type,r.sdp);break;case k.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:g.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}}},ne=Ie;ne.ID_PREFIX="dc_",ne.MAX_BUFFERED_AMOUNT=8*1024*1024;var it=class{constructor(t){this._options=t}_buildUrl(t){let n=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+t;return n+="?ts="+new Date().getTime()+""+Math.random(),n}retrieveId(){return Q(this,null,function*(){let t=this._buildUrl("id");try{let r=yield fetch(t);if(r.status!==200)throw new Error(`Error. Status:${r.status}`);return r.text()}catch(r){g.error("Error retrieving ID",r);let n="";throw this._options.path==="/"&&this._options.host!==b.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}})}listAllPeers(){return Q(this,null,function*(){let t=this._buildUrl("peers");try{let r=yield fetch(t);if(r.status!==200){if(r.status===401){let n="";throw this._options.host===b.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${r.status}`)}return r.json()}catch(r){throw g.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r)}})}};var st=class extends gr.EventEmitter{constructor(t,r){super();this._id=null;this._lastServerId=null;this._destroyed=!1;this._disconnected=!1;this._open=!1;this._connections=new Map;this._lostMessages=new Map;let n;if(t&&t.constructor==Object?r=t:t&&(n=t.toString()),r=Z({debug:0,host:b.CLOUD_HOST,port:b.CLOUD_PORT,path:"/",key:st.DEFAULT_KEY,token:b.randomToken(),config:b.defaultConfig},r),this._options=r,this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==b.CLOUD_HOST?this._options.secure=b.isSecure():this._options.host==b.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&g.setLogFunction(this._options.logFunction),g.logLevel=this._options.debug||0,this._api=new it(r),this._socket=this._createServerConnection(),!b.supports.audioVideo&&!b.supports.data){this._delayedAbort(T.BrowserIncompatible,"The current browser does not support WebRTC");return}if(!!n&&!b.validateId(n)){this._delayedAbort(T.InvalidID,`ID "${n}" is invalid`);return}n?this._initialize(n):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(T.ServerError,i))}get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){let t=Object.create(null);for(let[r,n]of this._connections)t[r]=n;return t}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}_createServerConnection(){let t=new tt(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(z.Message,r=>{this._handleMessage(r)}),t.on(z.Error,r=>{this._abort(T.SocketError,r)}),t.on(z.Disconnected,()=>{this.disconnected||(this.emitError(T.Network,"Lost connection to server."),this.disconnect())}),t.on(z.Close,()=>{this.disconnected||this._abort(T.SocketClosed,"Underlying socket is already closed.")}),t}_initialize(t){this._id=t,this.socket.start(t,this._options.token)}_handleMessage(t){let r=t.type,n=t.payload,i=t.src;switch(r){case k.Open:this._lastServerId=this.id,this._open=!0,this.emit(K.Open,this.id);break;case k.Error:this._abort(T.ServerError,n.msg);break;case k.IdTaken:this._abort(T.UnavailableID,`ID "${this.id}" is taken`);break;case k.InvalidKey:this._abort(T.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case k.Leave:g.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case k.Expire:this.emitError(T.PeerUnavailable,`Could not connect to peer ${i}`);break;case k.Offer:{let a=n.connectionId,p=this.getConnection(i,a);if(p&&(p.close(),g.warn(`Offer received for existing Connection ID:${a}`)),n.type===L.Media)p=new Ce(i,this,{connectionId:a,_payload:n,metadata:n.metadata}),this._addConnection(i,p),this.emit(K.Call,p);else if(n.type===L.Data)p=new ne(i,this,{connectionId:a,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable}),this._addConnection(i,p),this.emit(K.Connection,p);else{g.warn(`Received malformed connection type:${n.type}`);return}let f=this._getMessages(a);for(let s of f)p.handleMessage(s);break}default:{if(!n){g.warn(`You received a malformed message from ${i} of type ${r}`);return}let a=n.connectionId,p=this.getConnection(i,a);p&&p.peerConnection?p.handleMessage(t):a?this._storeMessage(a,t):g.warn("You received an unrecognized message:",t);break}}}_storeMessage(t,r){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(r)}_getMessages(t){let r=this._lostMessages.get(t);return r?(this._lostMessages.delete(t),r):[]}connect(t,r={}){if(this.disconnected){g.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(T.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}let n=new ne(t,this,r);return this._addConnection(t,n),n}call(t,r,n={}){if(this.disconnected){g.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(T.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!r){g.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}n._stream=r;let i=new Ce(t,this,n);return this._addConnection(t,i),i}_addConnection(t,r){g.log(`add connection ${r.type}:${r.connectionId} to peerId:${t}`),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(r)}_removeConnection(t){let r=this._connections.get(t.peer);if(r){let n=r.indexOf(t);n!==-1&&r.splice(n,1)}this._lostMessages.delete(t.connectionId)}getConnection(t,r){let n=this._connections.get(t);if(!n)return null;for(let i of n)if(i.connectionId===r)return i;return null}_delayedAbort(t,r){setTimeout(()=>{this._abort(t,r)},0)}_abort(t,r){g.error("Aborting!"),this.emitError(t,r),this._lastServerId?this.disconnect():this.destroy()}emitError(t,r){g.error("Error:",r);let n;typeof r=="string"?n=new Error(r):n=r,n.type=t,this.emit(K.Error,n)}destroy(){this.destroyed||(g.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(K.Close))}_cleanup(){for(let t of this._connections.keys())this._cleanupPeer(t),this._connections.delete(t);this.socket.removeAllListeners()}_cleanupPeer(t){let r=this._connections.get(t);if(!!r)for(let n of r)n.close()}disconnect(){if(this.disconnected)return;let t=this.id;g.log(`Disconnect peer with ID:${t}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit(K.Disconnected,t)}reconnect(){if(this.disconnected&&!this.destroyed)g.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)g.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(t=r=>{}){this._api.listAllPeers().then(r=>t(r)).catch(r=>this._abort(T.ServerError,r))}},ie=st;ie.DEFAULT_KEY="peerjs";var Ur={Peer:ie,util:b},fi=ie;window.peerjs=Ur;window.Peer=ie;export{fi as default,Ur as peerjs};
//# sourceMappingURL=peerjs.min.js.map
